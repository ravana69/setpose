function getCookieValue(a){var b=document.cookie.match('(^|;)\\s*'+a+'\\s*=\\s*([^;]+)');return b?b.pop():'';}
function closeControlsHint(){$(".controlshint").fadeOut();document.cookie="controlshint=false; max-age=31536000; path=/;";}
$(document).ready(function(){$("#resrange").next().val(renderer.getPixelRatio()+'x');$("#resrange").val(renderer.getPixelRatio());$("#fovrange").next().val(30);$("#fovrange").val(30);$(".myposelist summary h3").append(" ("+($(".myposelist button").length)+")");$(".submittedposelist summary h3").append(" ("+($(".submittedposelist button").length)+")");$(".poselist summary h3").append(" ("+($(".poselist button").length-1)+")");$(".proplist summary h3").append(" ("+($(".proplist .tablelabel").length)+")");if(getCookieValue("controlshint")!="false"){setTimeout(function(){$(".controlshint").css("display","inline-block");},1000);}
if($(window).width()<759){$(".signinbutton .userdropdown").on('click',function(){if($(".signinbutton .userdropdown ul").hasClass("expanded")){$(".signinbutton .userdropdown ul").removeClass("expanded");}else{$(".signinbutton .userdropdown ul").addClass("expanded");}});$('.panel input[type=range]').bind('touchstart',function(){$(".panel.expanded").css("opacity","0.5");}).bind('touchend',function(){$t=setTimeout(function(){$(".panel.expanded").css("opacity","1");},50);});}});$(function(){$('.lazy').Lazy();});function getPoseCode(poseid,type="preset",random=0,number=1){$.ajax({url:'https://setpose.com/scripts/getpose.php',type:'POST',data:{poseid:poseid,type:type,random:random,number:number},success:function(msg){if(msg.length>0){console.log(msg);return msg;}},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});}
$(".setposebtn, .randomposebtn").each(function(){$(this).on('click',function(){if($(this).data("posecode")){setPostureStr(JSON.stringify($(this).data("posecode")));}else{var poseid=$(this).data("poseid");var type="preset";var random=0;var number=1;var posenametxt=$(this).find(".btntext").text();if($(this).find(".btntext").text()==""){posenametxt=poseid;}
_paq.push(['trackEvent','Pose editor','Pose button click',posenametxt]);if($(this).hasClass("savedposes")){type="saved";}if($(this).hasClass("randomposebtn")){allposebtns=$(".poselist button");var randompose=$(allposebtns[Math.floor(Math.random()*allposebtns.length)])
poseid=randompose.data("poseid");showNotification(randompose.find(".btntext").text());}
if($(window).width()<759){if($(this).data('prop')){showNotification('Use this preset in combination with the '+$(this).data("prop")+' prop',5000);}}
$.ajax({url:'https://setpose.com/scripts/getpose.php',type:'POST',data:{poseid:poseid,type:type,random:random,number:number},success:function(msg){if(msg.length>0){setPostureStr(JSON.stringify(JSON.parse(msg)));}},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});}});});$(".controlshint").click(function(){closeControlsHint();});ground=new THREE.Mesh(new THREE.CircleGeometry(80,64),new THREE.MeshPhongMaterial({color:'#d9d9d9',shininess:1,precision:'mediump'}));ground.receiveShadow=true;ground.position.y=-29.5;ground.rotation.x=-Math.PI/2;scene.add(ground);$("#toggle-floor").change(function(){if(this.checked){scene.add(ground);renderer.render(scene,camera);_paq.push(['trackEvent','Pose editor','Floor toggle','On']);}else{scene.remove(ground);renderer.render(scene,camera);_paq.push(['trackEvent','Pose editor','Floor toggle','Off']);}});$("#toggle-shadow").change(function(){if(this.checked){light.castShadow=true;renderer.render(scene,camera);_paq.push(['trackEvent','Pose editor','Shadow toggle','On']);}else{light.castShadow=false;renderer.render(scene,camera);_paq.push(['trackEvent','Pose editor','Shadow toggle','Off']);}});$("#fovrange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());camera.fov=$(this).val();camera.updateProjectionMatrix();});$("#resrange").on("change mousemove touchmove",function(){$(this).next().val($(this).val()+'x');renderer.setPixelRatio($(this).val());renderer.render(scene,camera);});$("#lightrange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());light.intensity=$(this).val();renderer.render(scene,camera);});$("#backcolor").on("input change",function(){scene.background=new THREE.Color($(this).val());renderer.render(scene,camera);});$("#floorcolor").on("input change",function(){ground.material.color=new THREE.Color($(this).val());renderer.render(scene,camera);});$("#modelcolor").on("input change",function(){scene.remove(model);modelcolor=new THREE.Color($(this).val());createModel();setPostureStr(undoarray[undoarray.length-1]);renderer.render(scene,camera);});$("#headsizerange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.head.scale.set($(this).val(),$(this).val(),$(this).val());renderer.render(scene,camera);});$("#torsosizerange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.torso.scale.set($(this).val(),model.torso.scale["y"],model.torso.scale["z"]);renderer.render(scene,camera);});$("#torsowidthrange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.torso.scale.set(model.torso.scale["x"],model.torso.scale["y"],$(this).val());renderer.render(scene,camera);});$("#torsoheightrange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.torso.scale.set(model.torso.scale["x"],$(this).val(),model.torso.scale["z"]);renderer.render(scene,camera);});$("#armlsizerange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.l_arm.scale.set($(this).val(),$(this).val(),$(this).val());renderer.render(scene,camera);});$("#armrsizerange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.r_arm.scale.set($(this).val(),$(this).val(),$(this).val());renderer.render(scene,camera);});$("#leglsizerange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.l_leg.scale.set($(this).val(),$(this).val(),$(this).val());renderer.render(scene,camera);});$("#legrsizerange").on("change mousemove touchmove",function(){$(this).next().val($(this).val());model.r_leg.scale.set($(this).val(),$(this).val(),$(this).val());renderer.render(scene,camera);});function flipObj(obj,flip,z,y,x){const scale=new THREE.Vector3(1,1,1);if(z){scale.z*=-1;}if(y){scale.y*=-1;}
if(x){scale.x*=-1;}
obj.scale.multiply(scale);obj.position.set(obj.position.x,obj.position.y,obj.position.z*-1);if(flip){obj.flipped=true;}else{obj.flipped=false;}}
function handprop(toggle,object,righthand,arm){if(toggle.checked){var objectname=Object.keys({object})[0];_paq.push(['trackEvent','Pose editor','Enable hand prop',objectname]);var toggleparent=$(toggle).parent();toggleparent.parent().children().not(toggleparent).find('input').prop('checked',false);object.castShadow=true;if(righthand){model.r_fingers.attach(object);if(object.flipped){if(object.uuid===rifle.uuid){flipObj(object,0,0,1,0);console.log(object.uuid);}
else{flipObj(object,0,1);}}}else{model.l_fingers.attach(object);if(!object.flipped){if(object===rifle){flipObj(object,0,0,1,0);}
else{flipObj(object,1,1);}}}}else{object.removeFromParent();scene.remove(object);object=undefined;renderer.render(scene,camera);}
renderer.render(scene,camera);}
function groundprop(toggle,object,arm){if(toggle.checked){var objectname=Object.keys({object})[0];_paq.push(['trackEvent','Pose editor','Enable ground prop',objectname]);var toggleparent=$(toggle).parent();toggleparent.parent().children().not(toggleparent).find('input').prop('checked',false);object.castShadow=true;scene.add(object);if(arm){function setPosition(){setTimeout(function(){object.position.set(model.position.x,model.position.clone().setFromMatrixPosition(model.r_tips.matrixWorld).y+0.5,model.position.clone().setFromMatrixPosition(model.r_tips.matrixWorld).z-7.5);if(object.parent===scene){setPosition();}},10)}setPosition();}}else{scene.remove(object);}
renderer.render(scene,camera);}
var stickprop=new THREE.Mesh(new THREE.CylinderBufferGeometry(0.4,0.4,30),new THREE.MeshPhongMaterial({color:'crimson',precision:'mediump'}));stickprop.rotation.x=rad(90);stickprop.position.set(-0.5,1,13);var poleprop=new THREE.Mesh(new THREE.CylinderBufferGeometry(1,1,100),new THREE.MeshPhongMaterial({color:'crimson',precision:'mediump'}));poleprop.position.set(0,20,2.5);var barprop=new THREE.Mesh(new THREE.CylinderBufferGeometry(0.3,0.3,100),new THREE.MeshPhongMaterial({color:'crimson',precision:'mediump'}));barprop.rotation.z=rad(90);barprop.position.set(0,60,0);var basketball=new THREE.Mesh(new THREE.SphereGeometry(4.5,32,16),new THREE.MeshPhongMaterial({color:'crimson',precision:'mediump'}));basketball.rotation.x=rad(90);basketball.position.set(-4.5,1,0);var smallball=new THREE.Mesh(new THREE.SphereGeometry(1.6,32,16),new THREE.MeshPhongMaterial({color:'crimson',precision:'mediump'}));smallball.rotation.x=rad(90);smallball.position.set(-1.6,1,0);var loader=new THREE.ObjectLoader();var racket,bat,sword,pan,barbell,chair,bike;loader.load("https://setpose.com/props/racket.json",function(obj){racket=obj;racket.position.set(-0.5,1,8);});loader.load("https://setpose.com/props/bat.json",function(obj){bat=obj;bat.position.set(-0.5,1,8);});loader.load("https://setpose.com/props/sword.json",function(obj){sword=obj;sword.position.set(-0.5,1,8);});loader.load("https://setpose.com/props/pan.json",function(obj){pan=obj;pan.rotation.z=rad(90);pan.position.set(-0.5,1,8);});loader.load("https://setpose.com/props/cup.json",function(obj){cup=obj;cup.rotation.z=rad(180);cup.rotation.x=rad(90);cup.rotation.y=rad(-90);cup.position.set(1.2,0.5,0.8);});loader.load("https://setpose.com/props/knife.json",function(obj){knife=obj;knife.rotation.z=rad(-20);knife.position.set(-0.5,1,8);});loader.load("https://setpose.com/props/bow.json",function(obj){bow=obj;bow.rotation.z=rad(70);bow.position.set(-24,9.5,0);});loader.load("https://setpose.com/props/rifle.json",function(obj){rifle=obj;rifle.rotation.z=rad(0);rifle.rotation.x=rad(90);rifle.rotation.y=rad(60);rifle.position.set(7.5,-4,3.5);});loader.load("https://setpose.com/props/barbell.json",function(obj){barbell=obj;barbell.rotation.y=rad(90);barbell.position.set(0,0,0);});loader.load("https://setpose.com/props/chair.json",function(obj){chair=obj;chair.rotation.y=rad(180);chair.position.set(-5,-21.5,0);});loader.load("https://setpose.com/props/bike.json",function(obj){bike=obj;bike.rotation.y=rad(0);bike.position.set(0,-17,8.5);});$("#toggle-stick-r").change(function(){handprop(this,stickprop,1);});$("#toggle-stick-l").change(function(){handprop(this,stickprop,0);});$("#toggle-ball-r").change(function(){handprop(this,basketball,1);});$("#toggle-ball-l").change(function(){handprop(this,basketball,0);});$("#toggle-s-ball-r").change(function(){handprop(this,smallball,1);});$("#toggle-s-ball-l").change(function(){handprop(this,smallball,0);});$("#toggle-racket-r").change(function(){handprop(this,racket,1);});$("#toggle-racket-l").change(function(){handprop(this,racket,0);});$("#toggle-bat-r").change(function(){handprop(this,bat,1);});$("#toggle-bat-l").change(function(){handprop(this,bat,0);});$("#toggle-sword-r").change(function(){handprop(this,sword,1);});$("#toggle-sword-l").change(function(){handprop(this,sword,0);});$("#toggle-pan-r").change(function(){handprop(this,pan,1);});$("#toggle-pan-l").change(function(){handprop(this,pan,0);});$("#toggle-cup-r").change(function(){handprop(this,cup,1);});$("#toggle-cup-l").change(function(){handprop(this,cup,0);});$("#toggle-knife-r").change(function(){handprop(this,knife,1);});$("#toggle-knife-l").change(function(){handprop(this,knife,0);});$("#toggle-bow-r").change(function(){handprop(this,bow,1);});$("#toggle-bow-l").change(function(){handprop(this,bow,0);});$("#toggle-rifle-r").change(function(){handprop(this,rifle,1);});$("#toggle-rifle-l").change(function(){handprop(this,rifle,0);});$("#toggle-barbell-r").change(function(){groundprop(this,barbell,1);});$("#toggle-chair").change(function(){groundprop(this,chair);});$("#toggle-pole").change(function(){groundprop(this,poleprop);});$("#toggle-bar").change(function(){groundprop(this,barprop);});$("#toggle-bike").change(function(){groundprop(this,bike);});function HideMobilePanel(){if($(window).width()<759){if($(".panel").hasClass("expanded")){$(".panel").removeClass("expanded");$("html").css("overflow-y","auto");}else{$(".panel").addClass("expanded");$("html").css("overflow-y","hidden");}}}
$(".opensettingsbtn, .hidepanelbtn").on('click',function(){if($(window).width()<759){HideMobilePanel();}else{if($(".panel").hasClass("hidden")){$(".panel, .hidepanelbtn").removeClass("hidden");}else{$(".panel, .hidepanelbtn").addClass("hidden");}}});$('.setposebtn[data-prop]').each(function(){$(this).append('<img src="https://setpose.com/imgs/information-outline.svg" class="presetinfoicon"><div class="presetinfo">Use this preset in combination with the '+$(this).data("prop")+' prop</div><span class="presetinfopointer"></span>');});$("#ss").on('click',function(){_paq.push(['trackEvent','Pose editor','Screenshot']);var image=renderer.domElement.toDataURL("image/png").replace("image/png","image/octet-stream");$("#ssimg").attr("href",image);$("#ssimgprev").attr("src",image);$("#ssimg")[0].click();});$("#undo").on('click',function(){_paq.push(['trackEvent','Pose editor','Undo']);undo();});$(".closebtn").on('click',function(){$(this).parent().addClass("hidden");});$("#addposebtn").on('click',function(){if($(".addposeprompt").hasClass("hidden")){$(".poseprompt").addClass("hidden");$(".addposeprompt").removeClass("hidden");$("#addposeprompttext").val(model.postureString);$('#submitposebtn').prop('disabled',false);}else{$(".addposeprompt").addClass("hidden");}});$("#saveposebtn").on('click',function(){if($(".saveposeprompt").hasClass("hidden")){HideMobilePanel();$(".poseprompt").addClass("hidden");$(".saveposeprompt").removeClass("hidden");$("#saveposeprompttext").val(model.postureString);$('#submitposebtn').prop('disabled',false);}else{$(".saveposeprompt").addClass("hidden");}});$("#addposebtn").on('click',function(){var image=renderer.domElement.toDataURL("image/png").replace("image/png","image/octet-stream");$(".addposeimgwrap").css("background-image","url("+image+")");});$("#saveposebtn").on('click',function(){var image=renderer.domElement.toDataURL("image/png").replace("image/png","image/octet-stream");$(".addposeimgwrap").css("background-image","url("+image+")");});$(".modelswitch").change(function(){changeModel(this.value);});function changeModel(modeltype){var currentpose=model.postureString;detailedmodel=animemodel=animemodel2=detailedmodel2=bodybuilder=false;scene.remove(model);_paq.push(['trackEvent','Pose editor','Model change',modeltype]);if(modeltype==="detailed"){detailedmodel=true;$(".modelswitch")[0].value="detailed";}else if(modeltype==="anime"){animemodel=true;$(".modelswitch")[0].value="anime";}else if(modeltype==="anime-2"){animemodel2=true;$(".modelswitch")[0].value="anime-2";}else if(modeltype==="detailed-2"){detailedmodel=true;detailedmodel2=true;$(".modelswitch")[0].value="detailed-2";}else if(modeltype==="bodybuilder"){bodybuilder=true;$(".modelswitch")[0].value="bodybuilder";}else{$(".modelswitch")[0].value="basic";}
createModel();model.postureString=currentpose;renderer.render(scene,camera);}
$("#drawing-guide").change(function(){var currentpose=model.postureString;scene.remove(model);if(this.checked){drawingguide=true;transparantmodel=true;_paq.push(['trackEvent','Pose editor','Drawing guides','On']);}else{drawingguide=false;transparantmodel=false;_paq.push(['trackEvent','Pose editor','Drawing guides','Off']);}
createModel();model.postureString=currentpose;renderer.render(scene,camera);});$("#resetbtn").on('click',function(){_paq.push(['trackEvent','Pose editor','Reset model']);model.postureString='{"version":6,"data":[0,[0,-90,0],[0,0,-2],[0,0,5],[6,0,0],[0],[-6,-6,-0.6],[-6,0,0],[0],[6,6,-0.6],[7,-0.6,-5],[15],[-15,0,0],[10,10],[-7,0.6,-5],[15],[15,0,0],[10,10]]}';camera.position.set(0,0,150);camera.rotation.set(0,0,0);changeModel();renderer.render(scene,camera);syncPose(model.postureString);});$("#submitposebtn").on('click',function(){var posename=$("#addposepromptname").val();var posecode=$("#addposeprompttext").val();if(posename!=""&&posecode!=""){$.ajax({url:'https://setpose.com/scripts/submitpose.php',type:'POST',data:{posename:posename,posecode:posecode},success:function(msg){$('#submitposebtn').prop('disabled',true);$(".addposeprompt").addClass("hidden");showNotification("Pose submitted");},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});}else{showNotification("Please enter a name for your pose");}});function formatTimeLeft(time){if(time>60){const minutes=Math.floor(time/60);let seconds=time%60;if(seconds<10){seconds=`0${seconds}`;}
return `${minutes}:${seconds}`;}else{return time;}}
var timelimit,maxrounds,timepassed,timeleft,roundnr,posearray,timerInterval;function stopTimeChallenge(){timepassed=0;roundnr=1;posearray=[];clearInterval(timerInterval);timerInterval=null;}
function startTimeChallenge(){timelimit=$("#timechallengetime").val();maxrounds=$("#timechallengerounds").val();timecat=$("#timechallengecat").val();timepassed=0;timeleft=timelimit;roundnr=1;$(".timechallengesetup").addClass("hidden");$(".timechallengeinner").removeClass("hidden");$("#base-timer-label").html(formatTimeLeft(timeleft));_paq.push(['trackEvent','Time challenge','Start',`${timecat} cat, ${timelimit} seconds, ${maxrounds} rounds`]);$.ajax({url:'https://setpose.com/scripts/getpose.php',type:'POST',data:{poseid:0,random:1,cat:$("#timechallengecat").val(),number:maxrounds},success:function(msg){posesLoaded(msg);},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});function posesLoaded(poses){posearray=poses;for(var step=0;poses.length<maxrounds;step++){posearray.push(poses[step]);}
posearray.forEach(function(item,index){$(".timechallengeextended ul").append("<li>"+(index+1)+"/"+maxrounds+" — "+posearray[index]['posename']+"</li>");});$("#currenttimechallengeround").html(roundnr+"/"+maxrounds+" — "+posearray[roundnr-1]['posename']);setPostureStr(posearray[roundnr-1]['code']);$(".timechallengeextended ul").children().eq(roundnr-1).addClass("currentpose");function runTimeChallengeTimer(){timepassed=timepassed+=1;timeleft=timelimit-timepassed;$("#base-timer-label").html(formatTimeLeft(timeleft));var rawTimeFraction=timeleft/timelimit;rawTimeFraction=rawTimeFraction-(1/timelimit)*(1-rawTimeFraction);document.getElementById("base-timer-path-remaining").setAttribute("stroke-dasharray",(rawTimeFraction*283).toFixed(0)+" 283");if(timeleft===0){clearInterval(timerInterval);roundnr++;if(roundnr<=maxrounds){timepassed=0;timeleft=timelimit;$(".timechallengeextended ul .currentpose").removeClass("currentpose");$(".timechallengeextended ul").children().eq(roundnr-1).addClass("currentpose");$("#currenttimechallengeround").html(roundnr+"/"+maxrounds+" — "+poses[roundnr-1]['posename']);setPostureStr(poses[roundnr-1]['code']);document.getElementById("base-timer-path-remaining").setAttribute("stroke-dasharray","283 283");timerInterval=setInterval(()=>runTimeChallengeTimer(),1000);}}}
timerInterval=setInterval(runTimeChallengeTimer,1000);$(".timechallengeexpandbtn").on('click',function(){if($(".timechallengeextended").hasClass("hidden")){$(".timechallengeextended").removeClass("hidden");}else{$(".timechallengeextended").addClass("hidden");}});}}
$("#starttimechallengebtn").on('click',function(){startTimeChallenge();});$(".timechallenge .closebtn").on('click',function(){$(".timechallengesetup").removeClass("hidden");$(".timechallengeinner").addClass("hidden");$(".timechallengeextended ul").html("");stopTimeChallenge();_paq.push(['trackEvent','Time challenge','Stop']);});$(".proupgradeprompt .closebtn").on('click',function(){document.cookie="proupgradeprompt=false; max-age=31536000; path=/;";});$("#timedchallengebtn, #yogachallengebtn").on('click',function(){HideMobilePanel();$(".poseprompt").addClass("hidden");$(".timechallenge").removeClass("hidden");});$("#saveposepromptbtn").on('click',function(){var posename=$("#saveposepromptname").val();var posecode=$("#saveposeprompttext").val();if(posename!=""&&posecode!=""){$.ajax({url:'https://setpose.com/scripts/savepose.php',type:'POST',data:{posename:posename,posecode:posecode},success:function(msg){$(".saveposeprompt").addClass("hidden");showNotification("Pose saved");_paq.push(['trackEvent','Pose editor','Save pose',posename]);},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});}else{showNotification("Please enter a name for your pose");}});$(".posedeletebtn.submitted").each(function(){$(this).on('click',function(event){event.stopPropagation();var poseid=$(this).data("poseid");$.ajax({url:'https://setpose.com/scripts/deletesubmittedpose.php',type:'POST',data:{poseid:poseid},success:function(msg){showNotification("Pose deleted");},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});});});$(".posedeletebtn.savedposes").each(function(){$(this).on('click',function(event){event.stopPropagation();var poseid=$(this).data("poseid");var posebtn=$(this).parent();$.ajax({url:'https://setpose.com/scripts/deletesavedpose.php',type:'POST',data:{poseid:poseid},success:function(msg){showNotification("Pose deleted");posebtn.remove();_paq.push(['trackEvent','Pose editor','Delete pose']);},error:function(xhr,ajaxOptions,thrownError){showNotification(JSON.parse(xhr.responseText).errormessage);}});});});